// Copyright 2025 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package google.cloud.cloudsecuritycompliance.v1;

import "google/api/annotations.proto";
import "google/api/client.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/cloud/cloudsecuritycompliance/v1/common.proto";
import "google/longrunning/operations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "Google.Cloud.CloudSecurityCompliance.V1";
option go_package = "cloud.google.com/go/cloudsecuritycompliance/apiv1/cloudsecuritycompliancepb;cloudsecuritycompliancepb";
option java_multiple_files = true;
option java_outer_classname = "DeploymentProto";
option java_package = "com.google.cloud.cloudsecuritycompliance.v1";
option php_namespace = "Google\\Cloud\\CloudSecurityCompliance\\V1";
option ruby_package = "Google::Cloud::CloudSecurityCompliance::V1";

// Deployment service allows users to manage deployments of Frameworks and
// Cloud Controls on a target resource.
service Deployment {
  option (google.api.default_host) = "cloudsecuritycompliance.googleapis.com";
  option (google.api.oauth_scopes) =
      "https://www.googleapis.com/auth/cloud-platform";

  // Creates a new FrameworkDeployment in a given parent resource.
  rpc CreateFrameworkDeployment(CreateFrameworkDeploymentRequest)
      returns (google.longrunning.Operation) {
    option (google.api.http) = {
      post: "/v1/{parent=organizations/*/locations/*}/frameworkDeployments"
      body: "framework_deployment"
    };
    option (google.api.method_signature) =
        "parent,framework_deployment,framework_deployment_id";
    option (google.longrunning.operation_info) = {
      response_type: "FrameworkDeployment"
      metadata_type: "google.cloud.cloudsecuritycompliance.v1.OperationMetadata"
    };
  }

  // Deletes a single FrameworkDeployment.
  rpc DeleteFrameworkDeployment(DeleteFrameworkDeploymentRequest)
      returns (google.longrunning.Operation) {
    option (google.api.http) = {
      delete: "/v1/{name=organizations/*/locations/*/frameworkDeployments/*}"
    };
    option (google.api.method_signature) = "name";
    option (google.longrunning.operation_info) = {
      response_type: "google.protobuf.Empty"
      metadata_type: "google.cloud.cloudsecuritycompliance.v1.OperationMetadata"
    };
  }

  // Gets details of a single FrameworkDeployment.
  rpc GetFrameworkDeployment(GetFrameworkDeploymentRequest)
      returns (FrameworkDeployment) {
    option (google.api.http) = {
      get: "/v1/{name=organizations/*/locations/*/frameworkDeployments/*}"
    };
    option (google.api.method_signature) = "name";
  }

  // Lists FrameworkDeployments in a given parent resource.
  rpc ListFrameworkDeployments(ListFrameworkDeploymentsRequest)
      returns (ListFrameworkDeploymentsResponse) {
    option (google.api.http) = {
      get: "/v1/{parent=organizations/*/locations/*}/frameworkDeployments"
    };
    option (google.api.method_signature) = "parent";
  }

  // Gets details of a single CloudControlDeployment.
  rpc GetCloudControlDeployment(GetCloudControlDeploymentRequest)
      returns (CloudControlDeployment) {
    option (google.api.http) = {
      get: "/v1/{name=organizations/*/locations/*/cloudControlDeployments/*}"
    };
    option (google.api.method_signature) = "name";
  }

  // Lists CloudControlDeployments in a given parent resource.
  rpc ListCloudControlDeployments(ListCloudControlDeploymentsRequest)
      returns (ListCloudControlDeploymentsResponse) {
    option (google.api.http) = {
      get: "/v1/{parent=organizations/*/locations/*}/cloudControlDeployments"
    };
    option (google.api.method_signature) = "parent";
  }
}

// DeploymentState represents the state of the Deployment resource.
enum DeploymentState {
  // Unspecified. Invalid state.
  DEPLOYMENT_STATE_UNSPECIFIED = 0;

  // Validating the deployment.
  DEPLOYMENT_STATE_VALIDATING = 1;

  // Deployment is in CREATING state.
  DEPLOYMENT_STATE_CREATING = 2;

  // Deployment is in DELETING state.
  DEPLOYMENT_STATE_DELETING = 3;

  // Deployment has failed. All the changes made by the deployment have been
  // successfully rolled back. A deployment in the FAILED state can be retried
  // or deleted.
  DEPLOYMENT_STATE_FAILED = 4;

  // Deployment is successful and ready to use.
  DEPLOYMENT_STATE_READY = 5;

  // Deployment is partially deployed. All the Cloud Controls were not deployed
  // successfully. Retrying the operation will resume from the first failed
  // step.
  DEPLOYMENT_STATE_PARTIALLY_DEPLOYED = 6;

  // Deployment is partially deleted. All the Cloud Control Deployments were not
  // deleted successfully. Retrying the operation will resume from the first
  // failed step.
  DEPLOYMENT_STATE_PARTIALLY_DELETED = 7;
}

// FrameworkDeployment represents deployment of a Framework on a target
// resource. Supported target resources are organizations/{organization},
// folders/{folder}, and projects/{project}.
message FrameworkDeployment {
  option (google.api.resource) = {
    type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    pattern: "organizations/{organization}/locations/{location}/frameworkDeployments/{framework_deployment}"
    plural: "frameworkDeployments"
    singular: "frameworkDeployment"
  };

  // Identifier. FrameworkDeployment name in the following format:
  // organizations/{organization}/locations/{location}/frameworkDeployments/{framework_deployment_id}
  string name = 1 [(google.api.field_behavior) = IDENTIFIER];

  // Required. The details of the target resource on which the Framework is to
  // be deployed. It can either be an existing target resource or a new target
  // resource to be created.
  TargetResourceConfig target_resource_config = 2
      [(google.api.field_behavior) = REQUIRED];

  // Output only. The resource on which the Framework is deployed based on the
  // provided TargetResourceConfig in the following format:
  // organizations/{organization}, folders/{folder} or projects/{project}
  string computed_target_resource = 3
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Required. Reference to the framework to be deployed.
  FrameworkReference framework = 4 [(google.api.field_behavior) = REQUIRED];

  // Optional. User provided description of the Framework deployment
  string description = 5 [(google.api.field_behavior) = OPTIONAL];

  // Required. Deployment mode and parameters for each of the Cloud Controls in
  // the framework. Every Cloud Control in the framework must have a
  // CloudControlMetadata.
  repeated CloudControlMetadata cloud_control_metadata = 6
      [(google.api.field_behavior) = REQUIRED];

  // Output only. State of the Framework Deployment
  DeploymentState deployment_state = 7
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The time at which the resource was created.
  google.protobuf.Timestamp create_time = 9
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The time at which the resource last updated.
  google.protobuf.Timestamp update_time = 10
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Optional. To prevent concurrent updates from overwriting each other, always
  // provide the `etag` when you update a FrameworkDeployment. You can also
  // provide the `etag` when you delete a FrameworkDeployment, to help
  // ensure that you're deleting the intended version of the
  // FrameworkDeployment.
  string etag = 11 [(google.api.field_behavior) = OPTIONAL];

  // Output only. The display name of the target resource.
  string target_resource_display_name = 13
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The references to the cloud control deployments. It has all
  // the CloudControlDeployments which are either directly added in the
  // framework or through a CloudControlGroup. Example: If a framework
  // deployment deploys two cloud controls, cc-deployment-1 and cc-deployment-2,
  // then the cloud_control_deployment_references will be:
  // {
  //  cloud_control_deployment_reference: {
  //    cloud_control_deployment:
  //    "organizations/{organization}/locations/{location}/cloudControlDeployments/cc-deployment-1"
  //  },
  //  cloud_control_deployment_reference: {
  //   cloud_control_deployment:
  //   "organizations/{organization}/locations/{location}/cloudControlDeployments/cc-deployment-2"
  //  }
  repeated CloudControlDeploymentReference cloud_control_deployment_references =
      14 [(google.api.field_behavior) = OUTPUT_ONLY];
}

// CloudControlDeployment represents deployment of a CloudControl on a target
// resource. Supported target resources are organizations/{organization},
// folders/{folder}, and projects/{project}.
message CloudControlDeployment {
  option (google.api.resource) = {
    type: "cloudsecuritycompliance.googleapis.com/CloudControlDeployment"
    pattern: "organizations/{organization}/locations/{location}/cloudControlDeployments/{cloud_control_deployment}"
    plural: "cloudControlDeployments"
    singular: "cloudControlDeployment"
  };

  // Identifier. CloudControlDeployment name in the following format:
  // organizations/{organization}/locations/{location}/cloudControlDeployments/{cloud_control_deployment_id}
  string name = 1 [(google.api.field_behavior) = IDENTIFIER];

  // Required. The details of the target resource on which the CloudControl is
  // to be deployed. It can either be an existing target resource or a new
  // target resource to be created.
  TargetResourceConfig target_resource_config = 2
      [(google.api.field_behavior) = REQUIRED];

  // Output only. The resource on which the CloudControl is deployed based on
  // the provided TargetResourceConfig in the following format:
  // organizations/{organization}, folders/{folder} or projects/{project}.
  string target_resource = 3 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Required. Deployment mode and parameters for the Cloud Control.
  CloudControlMetadata cloud_control_metadata = 4
      [(google.api.field_behavior) = REQUIRED];

  // Optional. User provided description of the CloudControl deployment
  string description = 5 [(google.api.field_behavior) = OPTIONAL];

  // Output only. State of the CloudControl deployment
  DeploymentState deployment_state = 6
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The time at which the resource was created.
  google.protobuf.Timestamp create_time = 7
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The time at which the resource last updated.
  google.protobuf.Timestamp update_time = 8
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Optional. To prevent concurrent updates from overwriting each other, always
  // provide the `etag` when you update a CloudControlDeployment. You can also
  // provide the `etag` when you delete a CloudControlDeployment, to help
  // ensure that you're deleting the intended version of the
  // CloudControlDeployment.
  string etag = 9 [(google.api.field_behavior) = OPTIONAL];

  // Output only. The CloudControl after substitution of given parameters.
  CloudControl parameter_substituted_cloud_control = 10
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The references to the Framework deployments that this Cloud
  // Control deployment is part of. A Cloud Control deployment can be part of
  // multiple Framework deployments.
  repeated FrameworkDeploymentReference framework_deployment_references = 11
      [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The display name of the target resource.
  string target_resource_display_name = 12
      [(google.api.field_behavior) = OUTPUT_ONLY];
}

// TargetResourceConfig contains either the name of the target_resource or
// contains the config to create a new target_resource.
message TargetResourceConfig {
  // Resource config for the target_resource
  oneof resource_config {
    // Optional. CRM node in format organizations/{organization},
    // folders/{folder}, or projects/{project}
    string existing_target_resource = 1
        [(google.api.field_behavior) = OPTIONAL];

    // Optional. Config to create a new resource and use that as the
    // target_resource for deployment.
    TargetResourceCreationConfig target_resource_creation_config = 2
        [(google.api.field_behavior) = OPTIONAL];
  }
}

// TargetResourceCreationConfig contains the config to create a new resource to
// be used as the target_resource of a deployment.
message TargetResourceCreationConfig {
  // Resource creation config for the target_resource
  oneof resource_creation_config {
    // Optional. Config to create a new folder to be used as the target_resource
    // of a deployment.
    FolderCreationConfig folder_creation_config = 1
        [(google.api.field_behavior) = OPTIONAL];

    // Optional. Config to create a new project to be used as the
    // target_resource of a deployment.
    ProjectCreationConfig project_creation_config = 2
        [(google.api.field_behavior) = OPTIONAL];
  }
}

// FolderCreationConfig contains the config to create a new folder to be used
// as the target_resource of a deployment.
message FolderCreationConfig {
  // Required. The parent of the folder to be created. It can be an
  // organizations/{org} or folders/{folder}
  string parent = 1 [(google.api.field_behavior) = REQUIRED];

  // Required. Display name of the folder to be created
  string folder_display_name = 2 [(google.api.field_behavior) = REQUIRED];
}

// ProjectCreationConfig contains the config to create a new project to be used
// as the target_resource of a deployment.
message ProjectCreationConfig {
  // Required. organizations/{org} or folders/{folder}
  string parent = 1 [(google.api.field_behavior) = REQUIRED];

  // Required. Display name of the project to be created.
  string project_display_name = 2 [(google.api.field_behavior) = REQUIRED];

  // Required. Billing account id to be used for the project.
  string billing_account_id = 3 [(google.api.field_behavior) = REQUIRED];
}

// CloudControlMetadata contains the enforcement mode and parameters of a Cloud
// Control Deployment.
message CloudControlMetadata {
  // Required. Cloud control name and parameters.
  CloudControlDetails cloud_control_details = 1
      [(google.api.field_behavior) = REQUIRED];

  // Required. Enforcement mode of the cloud control
  EnforcementMode enforcement_mode = 2 [(google.api.field_behavior) = REQUIRED];
}

// Request message for CreateFrameworkDeployment API.
message CreateFrameworkDeploymentRequest {
  // Required. The parent resource of the FrameworkDeployment in the format:
  // organizations/{organization}/locations/{location}
  // Only global location is supported.
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      child_type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    }
  ];

  // Optional. User provided identifier. It should be unique in scope of a
  // parent. This is optional and if not provided, a random UUID will be
  // generated.
  string framework_deployment_id = 2 [(google.api.field_behavior) = OPTIONAL];

  // Required. The FrameworkDeployment to be created.
  FrameworkDeployment framework_deployment = 3
      [(google.api.field_behavior) = REQUIRED];
}

// Request message for DeleteFrameworkDeployment.
message DeleteFrameworkDeploymentRequest {
  // Required. name of the FrameworkDeployment to be deleted in the following
  // format:
  // organizations/{organization}/locations/{location}/frameworkDeployments/{framework_deployment_id}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    }
  ];

  // Optional. An opaque identifier for the current version of the resource.
  //
  // If you provide this value, then it must match the existing value. If the
  // values don't match, then the request fails with an
  // [ABORTED][google.rpc.Code.ABORTED] error.
  //
  // If you omit this value, then the resource is deleted regardless of its
  // current `etag` value.
  string etag = 2 [(google.api.field_behavior) = OPTIONAL];
}

// Request message for GetFrameworkDeployment.
message GetFrameworkDeploymentRequest {
  // Required. FrameworkDeployment name in the following format:
  // organizations/{organization}/locations/{location}/frameworkDeployments/{framework_deployment_id}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    }
  ];
}

// Request message for ListFrameworkDeployments.
message ListFrameworkDeploymentsRequest {
  // Required. parent resource of the FrameworkDeployment in the format:
  // organizations/{organization}/locations/{location}
  // Only global location is supported.
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      child_type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    }
  ];

  // Optional. Requested page size. Server may return fewer items than
  // requested. If unspecified, server will pick an appropriate default.
  int32 page_size = 2 [(google.api.field_behavior) = OPTIONAL];

  // Optional. A token identifying a page of results the server should return.
  string page_token = 3 [(google.api.field_behavior) = OPTIONAL];

  // Optional. Filter to be applied on the resource, defined by EBNF grammar
  // https://google.aip.dev/assets/misc/ebnf-filtering.txt.
  string filter = 4 [(google.api.field_behavior) = OPTIONAL];

  // Optional. Sort results. Supported are "name", "name desc" or "" (unsorted).
  string order_by = 5 [(google.api.field_behavior) = OPTIONAL];
}

// Response message for ListFrameworkDeployments.
message ListFrameworkDeploymentsResponse {
  // The list of FrameworkDeployments.
  repeated FrameworkDeployment framework_deployments = 1;

  // A token identifying a page of results the server should return.
  string next_page_token = 2;
}

// Request message for GetCloudControlDeployment.
message GetCloudControlDeploymentRequest {
  // Required. CloudControlDeployment name in the following format:
  // organizations/{organization}/locations/{location}/cloudControlDeployments/{cloud_control_deployment_id}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "cloudsecuritycompliance.googleapis.com/CloudControlDeployment"
    }
  ];
}

// Request message for ListCloudControlDeployments.
message ListCloudControlDeploymentsRequest {
  // Required. parent resource of the CloudControlDeployment in the format:
  // organizations/{organization}/locations/{location}
  // Only global location is supported.
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      child_type: "cloudsecuritycompliance.googleapis.com/CloudControlDeployment"
    }
  ];

  // Optional. Requested page size. Server may return fewer items than
  // requested. If unspecified, server will pick an appropriate default.
  int32 page_size = 2 [(google.api.field_behavior) = OPTIONAL];

  // Optional. A token identifying a page of results the server should return.
  string page_token = 3 [(google.api.field_behavior) = OPTIONAL];

  // Optional. Filter to be applied on the resource, defined by EBNF grammar
  // https://google.aip.dev/assets/misc/ebnf-filtering.txt.
  string filter = 4 [(google.api.field_behavior) = OPTIONAL];

  // Optional. Sort results. Supported are "name", "name desc" or "" (unsorted).
  string order_by = 5 [(google.api.field_behavior) = OPTIONAL];
}

// Response message for ListCloudControlDeployments.
message ListCloudControlDeploymentsResponse {
  // The list of CloudControlDeployments.
  repeated CloudControlDeployment cloud_control_deployments = 1;

  // A token identifying a page of results the server should return.
  string next_page_token = 2;
}

// The reference to a CloudControlDeployment.
message CloudControlDeploymentReference {
  // Output only. The name of the CloudControlDeployment. The format is:
  // organizations/{org}/locations/{location}/cloudControlDeployments/{cloud_control_deployment_id}
  string cloud_control_deployment = 1 [
    (google.api.field_behavior) = OUTPUT_ONLY,
    (google.api.resource_reference) = {
      type: "cloudsecuritycompliance.googleapis.com/CloudControlDeployment"
    }
  ];
}

// The reference to a FrameworkDeployment.
message FrameworkDeploymentReference {
  // Output only. The name of the FrameworkDeployment. The format is:
  // organizations/{org}/locations/{location}/frameworkDeployments/{framework_deployment_id}
  string framework_deployment = 1 [
    (google.api.field_behavior) = OUTPUT_ONLY,
    (google.api.resource_reference) = {
      type: "cloudsecuritycompliance.googleapis.com/FrameworkDeployment"
    }
  ];

  // Optional. The reference to the Framework that this deployment is for.
  // Example: {
  //   framework:
  //   "organizations/{org}/locations/{location}/frameworks/{framework}",
  //   major_revision_id: 1
  // }
  FrameworkReference framework_reference = 2
      [(google.api.field_behavior) = OPTIONAL];

  // Optional. The display name of the Framework that this FrameworkDeployment
  // is for.
  string framework_display_name = 3 [(google.api.field_behavior) = OPTIONAL];
}
